

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width=device-width,initial-scale=1" name="viewport" />

    <title>Defining Indexes &mdash; Facets Users Guide 0.1a documentation</title>
    
    <link rel="stylesheet" href="_static/facets_doc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/facets.ico"/>
    <link rel="top" title="Facets Users Guide 0.1a documentation" href="index.html" />
    <link rel="up" title="The MongoDB OML" href="mongodb_oml.html" />
    <link rel="next" title="Limitations of the MongoDB OML" href="mongodb_limitations.html" />
    <link rel="prev" title="The MongoDB Class" href="mongodb_mongodb.html" /> 
  </head>
  <body>
<div class="header">
  <img src="_static/logo.jpg">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mongodb_limitations.html" title="Limitations of the MongoDB OML"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mongodb_mongodb.html" title="The MongoDB Class"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Facets Users Guide</a> &raquo;</li>
          <li><a href="mongodb_oml.html" accesskey="U">The MongoDB OML</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="mongodb_mongodb.html"
                        title="previous chapter">The MongoDB Class</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mongodb_limitations.html"
                        title="next chapter">Limitations of the MongoDB OML</a></p>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3>Links</h3>
<div class="logo"><a href="http://facetsproject.blogspot.com/">
    <img class="logo" src="_static/blogger.png" alt="Facets Blog"/>
    <span>Facets Blog</span>
</a></div>
<div class="logo"><a href="http://www.youtube.com/user/FacetsTV">
    <img class="logo" src="_static/youtube.png" alt="FacetsTV"/>
    <span>Facets TV</span>
</a></div>
<div class="logo"><a href="http://www.facebook.com/PyFacets">
    <img class="logo" src="_static/fb_logo.png" alt="facebook"/>
    <span>Facets on Facebook</span>
</a></div>
<div class="logo"><a href="https://github.com/davidmorrill/facets">
    <img class="logo" src="_static/github.png" alt="GitHub"/>
    <span>Facets GitHub Repository</span>
</a></div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-indexes">
<span id="mongodb-indexes"></span><h1>Defining Indexes</h1>
<p>As a performance tuning aid, the MongoDB OML allows you to turn any database
facet, or group of database facets, into a MongoDB index.</p>
<p>Indexes typically are used to improve the performance of queries which only
return a small fraction of all possible objects. Queries that return a
relatively large percentage of all available objects typically do not see
performance improvements when an index is added.</p>
<p>In addition, adding an index slows performance when adding, deleting or updating
objects in the database, since both the object data and the associated index
data must be updated.</p>
<p>You create an index simply my adding <em>index</em> metadata to any <em>DBxxx</em> facet
defined in a MongoDBObject subclass. If you recall, our example application
included the following class definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IndexWord</span> <span class="p">(</span> <span class="n">MongoDBObject</span> <span class="p">):</span>
    <span class="n">word</span>      <span class="o">=</span> <span class="n">DBStr</span><span class="p">(</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
    <span class="n">count</span>     <span class="o">=</span> <span class="n">DBInt</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">DBSet</span>
</pre></div>
</div>
<p>where we have added a MongoDB index for the IndexWord class&#8217;s <em>word</em> facet.</p>
<p>There are actually several different ways to specify <em>index</em> metadata. The
simplest method is to simply set <em>index = True</em>, which defines a simple,
ascending order, non-unique index of the specified facet.</p>
<p>You can also specify a more detailed description of the type of index you want
to create using a value of the form:
<em>index = &#8216;[ascending|descending] [unique] [name] [nnn]&#8217;</em></p>
<p>where:</p>
<dl class="docutils">
<dt><strong>ascending|descending</strong></dt>
<dd>Specifies the sort order used by the index. If not specified, the sort order
defaults to <em>ascending</em>.</dd>
<dt><strong>unique</strong></dt>
<dd>Specifies that all index values must be unique (i.e. no duplicate values are
allowed). Attempting to add a duplicate value to the index will raise an
exception. If <em>unique</em> is not explicitly specified, the default is to allow
duplicate (non-unique) values in the index.</dd>
<dt><strong>name</strong></dt>
<dd>Specifies the name to give the index within the MongoDB database. The name
is also used to group related facets when defining a multi-facet index (see
the next item). If not specified, the MongoDB database automatically creates
a name for you based on the associated facet names.</dd>
<dt><strong>nnn</strong></dt>
<dd><p class="first">Specifies the index of the facet within a multi-value index. That is, you
can create indexes based upon more than a single object facet. In such
cases, the facet values are added to the composite index in the order
specified by the <em>nnn</em> values.</p>
<p>If you are creating a multi-facet index, make sure that each facet&#8217;s <em>index</em>
metadata uses the same <em>name</em> value, since the <em>name</em> value is used to
determine which facets belong to the same index. The <em>nnn</em> value is then
used to define the position of a particular facet within the set of facets
defining the index.</p>
<p class="last">Note that the <em>nnn</em> values can have gaps. The values are only used to
perform an ascending order sort used for ordering all of the facets within
the composite index.</p>
</dd>
</dl>
<p>The values in the <em>index</em> metadata can be specified in any order. For example,
the following index definitions are all equivalent:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">name</span> <span class="o">=</span> <span class="n">DBStr</span><span class="p">(</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;ascending unique my_index 1&#39;</span> <span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">DBStr</span><span class="p">(</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;1 my_index unique&#39;</span> <span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">DBStr</span><span class="p">(</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;unique 1 ascending my_index&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>Indexes can be both added and removed. Indexes are added when the MongoDB OML
discovers <em>index</em> metadata on database facets which did not previously have an
index. Similarly, existing indexes are deleted when the MongoDB OML detects that
no <em>index</em> metadata is present on database facets which previously had an index
defined.</p>
<p>The indexes are added or deleted as soon as the change is discovered. So if you
already have a database with 10,000,000 objects in it and decide to add an index
to one of the object facets, you may see a possibly long delay the next time you
run your application as MongoDB adds the index to the database, since it will
have to create an index entry for each object already in the database.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mongodb_limitations.html" title="Limitations of the MongoDB OML"
             >next</a> |</li>
        <li class="right" >
          <a href="mongodb_mongodb.html" title="The MongoDB Class"
             >previous</a> |</li>
        <li><a href="index.html">Facets Users Guide</a> &raquo;</li>
          <li><a href="mongodb_oml.html" >The MongoDB OML</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, 2012 David C. Morrill.
    </div>
  </body>
</html>